<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SalesMap</title>



    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
    <script src="css/reset.css"></script>

    <style>
        
        .navbar {
            background-color: #00aaff;
            border: 1px solid #00aaff;
            color: white;
        }


        .dropdown-toggle a {
            color: white;
        }

        .dropdown-menu li {
            color: white;
        }

        
        table {
            width: 100%;
        }

        table
        , td
        , th {
            padding: 3px;
            text-align: center;
            font-size: small;
        }

        .navbar-nav :hover {
            background-color: black;
        }

        .main {
            /* margin: 10px; */
        }

        .detail {
            overflow: hidden;
            background-color: rgba(185, 183, 183, 0.467);
            border-radius: 5px;
            padding: 10px 5px;
            line-height: 0.5em;
        }

        .left {
            float: left;
        }

        .right {
            float: right;
            padding-bottom: 7px; 
        }

        section {
            padding: 20px;
        }

        .date {
            padding: 10px 0;
        }

      
    </style>


</head>

<body>


    <nav class="navbar navbar-inverse">
        <div class="container-fluid">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#myNavbar">
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="map.html" style="color: white;">SalesMap</a>
            </div>
            <div class="collapse navbar-collapse" id="myNavbar">
                <ul class="nav navbar-nav">
                    <li><a href="todolist.html"><span style="color: white;">To-Do-List</span></a></li>
                    <!-- <li><a href="team.html"><span style="color: white;">Team</span></a></li> -->
                    <li><a href="mywork.html"><span style="color: white;">Mywork</span></a></li>
                    <li><a href="myinfo.html"><span style="color: white;">MyInfo</span></a></li>
                    <li><a href="home.html"><span style="color: white;">logout</span></a></li>
                </ul>
            </div>
        </div>
    </nav>

    <section>
        <div class="main">
            <div id="map" style="width:100%;height:600px; "></div>
            <div id="clickLatlng"></div>
        </div>       
    </section>


    <script type="text/javascript"
        src="//dapi.kakao.com/v2/maps/sdk.js?appkey=ee3b34b417b65bc0b7697bb57a7714ed"></script>
    <script>
        // 마커를 표시할 위치와 title 객체 배열입니다 
        const myLatLng = { lat: "", lng: "" };
        var positions = new Array();
        // 주소-좌표 변환 객체를 생성합니다
        // var geocoder = new kakao.maps.services.Geocoder();


        console.log(myLatLng.lat +" / " + myLatLng.lng);

        //  // 위치 정보 성공 함수
        function coordSuccess(position) {    //첫번째 매개변수의 사용자의 위치 정보
            myLatLng.lat = position.coords.latitude;
            myLatLng.lng = position.coords.longitude;
            console.log(myLatLng.lat, myLatLng.lng)
        }

        function coordFail(position) {    //첫번째 매개변수의 사용자의 위치 정보

        }

        function initMap() {
            navigator.geolocation.getCurrentPosition(coordSuccess, coordFail);
        }



        var mapContainer = document.getElementById('map'), // 지도를 표시할 div 
            mapOption = {
                center: new kakao.maps.LatLng(37.51578796247853, 127.09910998428964), // 지도의 중심좌표
                // center: new kakao.maps.LatLng(myLatLng.lat, myLatLng.lng), // 지도의 중심좌표
                level: 3 // 지도의 확대 레벨 
            };

        var map = new kakao.maps.Map(mapContainer, mapOption); // 지도를 생성합니다

        // HTML5의 geolocation으로 사용할 수 있는지 확인합니다 
        if (navigator.geolocation) {

            // GeoLocation을 이용해서 접속 위치를 얻어옵니다
            navigator.geolocation.getCurrentPosition(function (position) {

                myLatLng.lat = position.coords.latitude; // 위도
                myLatLng.lng = position.coords.longitude; // 경도

                var locPosition = new kakao.maps.LatLng(lat, lon), // 마커가 표시될 위치를 geolocation으로 얻어온 좌표로 생성합니다
                    message = '<div style="padding:5px; ">현위치</div>'; // 인포윈도우에 표시될 내용입니다

                // 마커와 인포윈도우를 표시합니다
                displayMarker(locPosition, message);

            });

        } else { // HTML5의 GeoLocation을 사용할 수 없을때 마커 표시 위치와 인포윈도우 내용을 설정합니다

            var locPosition = new kakao.maps.LatLng(37.51578796247853, 127.09910998428964),
                message = 'geolocation을 사용할수 없어요..'

            displayMarker(locPosition, message);
        }

        // 지도에 마커와 인포윈도우를 표시하는 함수입니다
        function displayMarker(locPosition, message) {

            // 마커를 생성합니다
            var marker = new kakao.maps.Marker({
                map: map,
                position: locPosition
            });

            var iwContent = message, // 인포윈도우에 표시할 내용
                iwRemoveable = true;

            // // 인포윈도우를 생성합니다
            // var infowindow = new kakao.maps.InfoWindow({
            //     content : iwContent,
            //     removable : iwRemoveable
            // });

            // // 인포윈도우를 마커위에 표시합니다 
            // infowindow.open(map, marker);

            // 지도 중심좌표를 접속위치로 변경합니다
            map.setCenter(locPosition);
        }



        // 지도를 클릭한 위치에 표출할 마커입니다
        var marker = new kakao.maps.Marker({
            // 지도 중심좌표에 마커를 생성합니다 
            position: map.getCenter()
        });
        // 지도에 마커를 표시합니다
        marker.setMap(map);
        
        // 클릭한 위치에 대한 주소를 표시할 인포윈도우입니다
        var infowindow = new kakao.maps.InfoWindow({zindex:1});


        // 지도에 클릭 이벤트를 등록합니다
        // 지도를 클릭하면 마지막 파라미터로 넘어온 함수를 호출합니다
        kakao.maps.event.addListener(map, 'click', function (mouseEvent) {

            // 클릭한 위도, 경도 정보를 가져옵니다 
            var latlng = mouseEvent.latLng;

            // 팝업

            var title = prompt("매장 이름을 입력하세요", "");

            console.log(title);

            if (title === "") {
                alert("매장 이름을 입력하세요.")
                return;

            } else if (title == null) {
                return;

            } else {

                var data = [title, latlng];

                positions.push(data);

                // 마커 이미지의 이미지 주소입니다
                var imageSrc = "https://t1.daumcdn.net/localimg/localimages/07/mapapidoc/markerStar.png";

                for (var i = 0; i < positions.length; i++) {

                    // 마커 이미지의 이미지 크기 입니다
                    var imageSize = new kakao.maps.Size(24, 35);

                    // 마커 이미지를 생성합니다    
                    var markerImage = new kakao.maps.MarkerImage(imageSrc, imageSize);

                    // 마커를 생성합니다
                    var markerInfo = new kakao.maps.Marker({
                        map: map, // 마커를 표시할 지도
                        position: latlng, // 마커를 표시할 위치
                        title: title, // 마커의 타이틀, 마커에 마우스를 올리면 타이틀이 표시됩니다
                        image: markerImage // 마커 이미지 
                    });

                }

            }

            var message = '클릭한 위치의 위도는 ' + latlng.getLat() + ' 이고, ';
            message += '경도는 ' + latlng.getLng() + ' 입니다';

            var resultDiv = document.getElementById('clickLatlng');
            resultDiv.innerHTML = message;

            info();

        });


        
        function info() {
            console.log(positions);
        }


        

    </script>

</body>

</html>